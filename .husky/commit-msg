#!/bin/sh

# SPDX-FileCopyrightText: 2025 hexaTune LLC
# SPDX-License-Identifier: MIT

# Commit message hook for Commitlint validation
# This hook ensures commit messages follow conventional commit format

CONFIG=".github/.commitlintrc.yml"
MSG_FILE="$1"

# Add node_modules/.bin to PATH for commitlint
export PATH="node_modules/.bin:$PATH"

echo "ğŸ” Running Commitlint check..."

# Check if commitlint is installed
if ! command -v commitlint >/dev/null 2>&1; then
    echo ""
    echo "âŒ ERROR: Commitlint CLI not found!"
    echo ""
    echo "ğŸ“¦ Commitlint is required for commit message validation."
    echo ""
    echo "ğŸ”§ Installation Instructions:"
    echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
    echo ""
    echo "Install commitlint in the root directory:"
    echo "  $ pnpm add -D @commitlint/cli @commitlint/config-conventional"
    echo ""
    echo "Or with npm:"
    echo "  $ npm install -D @commitlint/cli @commitlint/config-conventional"
    echo ""
    echo "Note: For Flutter projects, commitlint is used only for commit message"
    echo "      validation, not for Dart/Flutter code linting."
    echo ""
    echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
    echo ""
    exit 1
fi

# Check if config file exists
if [ ! -f "$CONFIG" ]; then
    echo ""
    echo "âŒ ERROR: Commitlint config not found!"
    echo ""
    echo "Expected location: $CONFIG"
    echo "Please ensure the config file exists before committing."
    echo ""
    exit 1
fi

# Run commitlint
echo "ğŸ“Œ Validating commit message format..."
echo ""

if ! commitlint --config "$CONFIG" --edit "$MSG_FILE"; then
    echo ""
    echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
    echo "âŒ Commit message validation FAILED!"
    echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
    echo ""
    echo "ğŸ“š Commit message must follow Conventional Commits format:"
    echo ""
    echo "   <type>(<optional-scope>): <description>"
    echo ""
    echo "Allowed types:"
    echo "  â€¢ feat     - New feature"
    echo "  â€¢ fix      - Bug fix"
    echo "  â€¢ docs     - Documentation changes"
    echo "  â€¢ style    - Code formatting (no logic change)"
    echo "  â€¢ refactor - Code restructuring"
    echo "  â€¢ perf     - Performance improvement"
    echo "  â€¢ test     - Test changes"
    echo "  â€¢ chore    - Maintenance tasks"
    echo "  â€¢ ci       - CI/CD changes"
    echo "  â€¢ build    - Build system changes"
    echo "  â€¢ release  - Release preparation"
    echo "  â€¢ hotfix   - Critical emergency fix"
    echo ""
    echo "Examples:"
    echo "  âœ… feat(core_kit): add AppButton loading state"
    echo "  âœ… fix(auth_kit): resolve token refresh issue"
    echo "  âœ… docs(README): update installation steps"
    echo "  âœ… refactor(data_kit): simplify API client logic"
    echo "  âœ… test(forms_kit): add email validator tests"
    echo ""
    echo "See docs/COMMIT_STRATEGY.md for more details."
    echo ""
    exit 1
fi

echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "âœ… Commit message validation PASSED!"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""
exit 0
