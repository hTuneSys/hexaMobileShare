#!/usr/bin/env sh
# SPDX-FileCopyrightText: 2025 hexaTune LLC
# SPDX-License-Identifier: MIT

echo ""
echo "ğŸ” Running CI checks before push..."
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""

# Format check
echo "ğŸ“ [1/3] Checking Dart formatting..."
pnpm ci:format
if [ $? -ne 0 ]; then
    echo ""
    echo "âŒ Format check failed!"
    echo "ğŸ’¡ Run 'pnpm format:fix' to auto-fix formatting issues"
    echo ""
    exit 1
fi
echo "âœ… Format check passed"
echo ""

# Static analysis
echo "ğŸ”¬ [2/3] Running static analysis..."
pnpm ci:analyze
if [ $? -ne 0 ]; then
    echo ""
    echo "âŒ Static analysis failed!"
    echo "ğŸ’¡ Fix analyzer warnings before pushing"
    echo ""
    exit 1
fi
echo "âœ… Static analysis passed"
echo ""

# Tests
echo "ğŸ§ª [3/3] Running tests..."
pnpm ci:test
if [ $? -ne 0 ]; then
    echo ""
    echo "âŒ Tests failed!"
    echo "ğŸ’¡ Fix failing tests before pushing"
    echo ""
    exit 1
fi
echo "âœ… Tests passed"
echo ""

echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "âœ¨ All CI checks passed! Proceeding with push..."
echo ""
